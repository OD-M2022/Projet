<div class="page-wrapper">
  <div class="content container-fluid">  
    <div class="row">
      <h1 class="text-center">Liste des salariés</h1>
      <div class="col-md-6">
        <div class="row">
          <div class="form-group form-inline">
            <label for="filtre">Filtre </label>
              <select class="form-control" (change)="onFilterChange($event.target.value)">
                <option value="ALL">Tout</option>
                <option *ngFor="let statut of profileStatut" value="{{ statut.value }}">{{ statut.name }}</option>
            </select>
          </div> 
        </div>
      </div>
      <div class="col-md-6 text-right">
        <div class="row">
          <form [formGroup]="userForm" (ngSubmit)="updateStatut()">
            <div class="form-group form-inline">
              <label for="status">Modifier statut </label>             
              <select class="form-control" formControlName="statut">
                <option *ngFor="let statut of statutValidattion" [ngValue]="statut.value">{{ statut.name }}</option>
              </select>
              <button [class.disabled]="this.disabled" [disabled]="this.disabled" class="form-control btn btn-default btn-primary">
                <span *ngIf="this.loading" class="spin-loader"></span>
                <span *ngIf="!this.loading">Envoyer</span>
              </button>
            </div> 
          </form>
        </div>
      </div>
      <div class="table-responsive card-box col-xs-12">
        <table class="table">
          <thead>
            <tr>
              <th><input [checked]="this.allSelected"(change)="checkUncheckAll($event)" name="checkbox" type="checkbox" class="checkbox"></th>
              <th class="text-center"><b>Matricule</b></th>
              <th class="text-center"><b>Nom</b></th>
              <th class="text-center"><b>Prénom</b></th>
              <th class="text-center"><b>Numéro CIN</b></th>
              <th class="text-center"><b>Telephone</b></th>
              <th class="text-center"><b>Poste</b></th>
              <th class="text-center"><b>Statut</b></th> 
              <th class="text-center"><b>Actions</b></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of (users | filterByStatut: filterStatut)">
              <td><input [checked]="user.selected" (change)="onCheckbox($event)" name="checkbox" type="checkbox" class="checkbox" value="{{ user.id }}"></td>
              <td class="text-center"> {{ user.profile.matricule }} </td>
              <td class="text-center"> {{ user.profile.nom }} </td>
              <td class="text-center"> {{ user.profile.prenom }} </td>
              <td class="text-center"> {{ user.profile.numeroCIN }} </td>
              <td class="text-center"> {{ user.profile.numeroTelephoneN1 }} </td>
              <td class="text-center"> {{ user.profile.poste }} </td>
              <td class="text-center"> <span [ngClass]="{
                'label-warning': user.profile.statut === 'CREATED', 
                'label-success': user.profile.statut === 'VALIDATED',
                'label-default': user.profile.statut === 'ARCHIVATED' 
              }"
                class="label">{{ this.getStatut(user.profile.statut)}}</span> </td> 
              <td class="text-center" style="width: 100px">
                <span [class.disabled]="user.profile.statut !== 'CREATED' || !user.profile.editedFields || user.profile.editedFields === ''" class="fa fa-eye" (click)="openModal(template, user)"></span>
                <span class="fa fa-user" alt="Consulter" routerLink="/users/view/{{user.id}}"></span>
                <span [class.disabled]="user.profile.statut === 'ARCHIVATED'" class="fa fa-pencil" alt="Modifier" (click)="editProfile(user)"></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>  
  </div>
</div>

<ng-template #template>
  <div class="modal-header">
    <h4 id="dialog-sizes-name1" class="modal-title pull-left">Liste des modifications</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th class="text-center"><b>Label</b></th>
            <th class="text-center"><b>Modification</b></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let content of modalContent.editedFields | keyvalue">
            <td class="text-center"> {{ content.key }} </td>
            <td class="text-center"> {{ content.value }} </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- <pre> 
      <code>
         {{ this.modalContent | json }}
      </code>
    </pre> -->
  </div>
</ng-template>